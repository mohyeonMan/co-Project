<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  <mapper namespace="productSQL">
  <insert id="productWrite" parameterType="product">
		INSERT INTO producttable(subject, 
								 category_1, 
								  
								 content, 
								 hopeprice, 
								 startprice, 
								 nowprice,
								 unitprice, 
								 trade_way, 
								 enddays_year, 
								 enddays_month, 
								 enddays_day, 
								 enddays_hour, 
								 enddays_min, 
								 id, 
								 product_seq, 
								 img1, 
								 img2, 
								 img3, 
								 img4, 
								 logdate, 
								 hit) 
		VALUES (#{subject}
				,#{category_1}
				
				,#{content}
				,#{hopeprice}
				,#{startprice}
				,#{startprice}
				,#{unitprice}
				,#{trade_way}
				,#{enddays_year}
				,#{enddays_month}
				,#{enddays_day}
				,#{enddays_hour}
				,#{enddays_min}
				,#{id}
				,product_seq.nextval
				,#{img1}
				,#{img2}
				,#{img3}
				,#{img4}
				,sysdate
				,0)
	</insert> 
	
	<select id="getList" resultType="product">
		SELECT * FROM producttable ORDER by product_seq DESC
	</select>
	<select id="getList2" resultType="product">
		SELECT * FROM producttable ORDER by startprice DESC
	</select>
	<select id="getView" parameterType="map" resultType="product">
		select * from producttable where product_seq=#{product_seq}
	</select>
	<update id="updateHit" parameterType="map">
		update  producttable set hit = #{hit} where product_seq = #{product_seq}
	</update>
	<update id="test"><!--  -->
		update  producttable 
		set prdstatus = 
		case
    		WHEN enddate <![CDATA[ < ]]> sysdate AND get_id IS NOT NULL 
    		THEN '낙찰'
    		WHEN enddate <![CDATA[ < ]]> sysdate AND get_id IS NULL 
    		THEN '유찰'
    		when enddate<![CDATA[ > ]]>sysdate  then '진행중'  
    		end 
    		WHERE  prdstatus != '낙찰' and prdstatus != '유찰'
    		
<!-- 			update  producttable 
				set testnum = 
				case
				    WHEN logdate < sysdate
			         AND get_id IS NOT NULL THEN
			        3
			    WHEN logdate < sysdate
			         AND get_id IS NULL THEN
			        2
			    when logdate>sysdate  then 1  
			    end 
			    WHERE testnum != 3 and testnum != 2;
			    		 -->
    		
	</update>
  </mapper>